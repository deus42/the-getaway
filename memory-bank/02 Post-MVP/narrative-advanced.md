# Post-MVP: Narrative Systems (Advanced)

Moved out of memory-bank/01 MVP/Game Design.md to keep the MVP doc focused.

Tone-Preserving Procedural Dialogue

The tone mixer keeps emergent dialogue aligned with the agreed voice pillars while giving designers replayable variation:
	•	Trait Axes: Author, persona, and scene fingerprints score seven axes (warmth, melancholy, sarcasm, surrealism, urgency, steadiness, wit) in the `[0,1]` range so the runtime can blend them deterministically.
	•	Rhetorical Controls: Blended traits feed sentence length mean/std dev, metaphor rate, and fragment preference. Urgency shortens lines, surrealism and melancholy raise imagery density, steadiness reins in fragments.
	•	Weighted Blending: Default weighting is `0.4 author / 0.4 persona / 0.2 scene`. When no scene hint is supplied the weights re-normalise to author/persona. Designers can override the weighting per request if a scene mood should dominate.
	•	Templates & Palettes: Micro-templates (deadpan reassurance, urgent push, surreal resilience) declare slots that draw from trait-weighted synonym palettes. Entries may tag motifs such as `motif.streetlight`, `motif.compass`, `motif.rain_hum`, `motif.glowsticks` to maintain recurring imagery.
	•	Motif Hygiene: Each persona owns a lightweight motif counter. Selecting a motif-tagged line bumps the counter, reducing its weight on the next pull while the manager decays counters every time the persona speaks so imagery can return after a breather.
	•	Deterministic Seeds: Dialogue nodes provide a `seedKey` that, combined with `(dialogueId, nodeId)`, guarantees the same prose in UI, tests, and localisation tooling while preserving `node.text` as the fallback.
	•	Content Authoring: Author fingerprints live in `content/dialogueTone/authors.ts`, personas in `personas.ts`, scene hints in `scenes.ts`, and template/palette definitions in `templates.ts` / `palettes.ts`. Locale bundles opt in via `toneDefaults` / `tone` metadata so translators see both the generated output and the underlying fallback line.

Role-Based Procedural Dialogue Templates

Systemic NPC roles now draw from reusable dialogue families so ambient encounters stay coherent with the city’s fiction while reflecting moment-to-moment context:
	•	Content Registry: Role templates live in `the-getaway/src/content/dialogueTemplates/roles/` (merchant, checkpoint_guard, street_doc, gang_scout, safehouse_handler). Each entry defines a `templateKey`, summary, optional tone overrides, and whether it serves as the fallback line for that role.
	•	Gating Parameters: Templates can require specific faction standings, reputation thresholds, time-of-day windows, curfew states, blackout tiers, supply scarcity levels, hazard keywords, or owned perks. The resolver evaluates these constraints before sampling and automatically falls back to any `isFallback` variant when nothing matches.
	•	Token Replacement: Template text supports tokens like `{{highlightItem}}` or `{{intel}}`. Token resolvers are seeded helpers that select hazard-aware stock (battery bricks during blackouts, respirators during smog alerts), perk callouts, or patrol intel so lines stay fresh but on-theme.
	•	Deterministic Output: `resolveRoleDialogueTemplate` seeds selection with `(dialogueId, nodeId)` plus optional overrides, ensuring the same NPC delivers the same line for a given conversation while still allowing variability across runs.
	•	Tone Integration: Template authors may supply `toneOverrides` (preferred persona/template/scene) so the tone mixer keeps the cadence consistent with the intended speaker while still leveraging palette/motif blending.
	•	Authoring Flow: Narrative data opts into a systemic line by storing `[roleTemplate:merchant.default_greeting]` (or similar) in the dialogue node. The DialogueOverlay resolves the template, merges tone overrides, and forwards the enriched node to the mixer so handcrafted and systemic content share the same UI path.

Choices & Consequences

Throughout the game, players will face decisions that have meaningful consequences on the story and world. We ensure that choices are not just cosmetic – they lead to different outcomes, some immediately visible and others that unfold later:
	•	Branching Missions: Many missions have multiple ways to complete them, and the player’s choices in those missions can set off different chains of events. For example, a mission might be to deal with a corrupt official. The player could choose to bribe the official (gaining favor with them but reinforcing corruption), expose their crimes to the public (earning karma and public support but maybe causing chaos in that district), or assassinate them (pleasing their enemies and instilling fear). Each approach would result in a different follow-up scenario or quest.
	•	Moral Dilemmas: The game frequently presents moral dilemmas. These aren’t just “good vs evil” but often difficult trade-offs. For instance, you might have to choose between saving a group of civilians or capturing a high-value target who’s responsible for their plight. You can’t do both because of time constraints. Such a decision will affect your karma and faction relations (maybe the authorities praise you for capturing the criminal but the local populace despises you for the collateral damage). The story will adapt: if you save the civilians, one of them might become an ally or quest-giver later; if not, perhaps their community rises up in anger or despair.
	•	Long-Term Consequences: The outcome of early choices can cascade into later parts of the game. If in the early game you help a small faction grow strong, in the mid-game that faction might dominate a district and change the questlines available there. If you betray someone early on, don’t be surprised if they (or their friends) come seeking revenge when you least expect it. We track these key decisions in the background and use them to branch dialogues, quests, and even battles (for example, an enemy you spared might show up in a final battle to aid you, or to fight you because they changed their mind about you).
	•	Dynamic Story Adaptation: Because the narrative is open, the game logic will adapt to what the player has done. There will rarely be a fail-state for the overall story due to a choice; instead, the story pivots. If you refuse to help a faction with an important task, maybe they fail without you and you experience the fallout (the city is worse off or another faction steps in). If you kill an important NPC, the game will route around that – perhaps their lieutenant takes over and the questline continues with a vengeful spin. The idea is to let the player truly shape the narrative but still ensure there’s a coherent story path forward.
	•	Feedback on Choices: To make consequences clear, the game will often provide feedback. NPC dialogue or in-game news broadcasts might talk about what you did (“After the water supply was poisoned, citizens are falling ill…”). Faction reputation changes are shown immediately. Major branches will usually be telegraphed (“If you do this, there’s no going back”). And the quest log will update to reflect the outcomes (“You chose to arm the rebels; the Corporate faction will remember this.”). We want players to feel the weight of decisions without being blind-sided by outcomes that seem random.

In essence, The Getaway treats player choices as a core mechanic, just as important as combat or exploration. The world's story is the sum of what the player decides to do (or not do), providing a personalized narrative experience.

Faction, Character, and Event-Driven Quests

The storytelling is delivered via quests, which can be categorized by their narrative drivers:
	•	Faction-Driven Quests: Each major faction provides a series of quests reflecting their goals and perspective on the city’s problems. For example, working with a militant Resistance faction might involve missions to sabotage corporate installations, rescue political prisoners, and rally support among citizens. These quests advance that faction’s storyline and typically culminate in a high-stakes operation that can significantly change the city’s status quo (like a revolution or the ousting of a rival faction). Faction quests often force the player to confront where their loyalties lie, sometimes presenting critical choices (e.g., whether to follow a faction leader’s order that goes against the player’s morals).
	•	Character-Driven Quests: Significant NPCs (including possible companions or notable figures in the world) have their own quest lines. These quests delve into personal stories and relationships. For example, a companion who is a former gang member might ask for help dealing with their old crew, leading to a story of revenge or redemption. A neutral character like a local doctor might have a quest to secure medical supplies for the sick, revealing backstory about a plague or experiment in the city. These quests personalize the experience and often reward the player with unique items or allies, as well as karma changes depending on how they resolve personal dilemmas.
	•	Event-Driven Quests: Some quests are triggered by the game’s dynamic events or world state changes rather than a fixed NPC quest-giver. If a famine breaks out in a district due to a supply line being cut (perhaps as a result of a previous quest), an event-driven quest might activate to secure food for that district, either by negotiation or force. If a major character is assassinated by someone other than the player (say, a power struggle within a faction), the player might get swept up in the aftermath via quests to restore order or exploit the chaos. These quests ensure the world’s dynamic changes include the player in resolving them, making the player feel like a part of the living world narrative.
	•	Quest Webs: Often, quests interlink across these categories. A faction quest might introduce a character who later has their own personal quest. Or a personal quest might require choosing which faction’s help to enlist, thereby tying into faction reputation. Event-driven quests can segue into faction quests (e.g., a riot event might prompt the faction in charge of security to offer a quest to help quell the violence). The narrative design tries to web these together so that the overall plotlines weave into a cohesive experience rather than isolated tracks.
	•	Optional vs Main Quests: Faction quests could be considered “main” quests in the sense that pursuing at least one faction’s storyline is necessary to reach an ending. Character-driven quests are mostly optional but enrich the story and can influence the final outcome (for example, having a certain ally on your side might change an ending scene). Event-driven quests are often missable if you’re not in the right place at the right time, but they ensure the world never feels static. The quest journal will mark which ones are critical and which are optional, but we expect players to naturally gravitate towards the faction stories they care about as their main narrative.

By mixing these quest types, the game achieves a narrative that feels both expansive (many things happening in the city) and centered on the player's journey (since you decide which quests to follow and which causes to support). It's a balance of faction politics, personal stories, and emergent events that together tell the full story of The Getaway.

Multiple Endings & Open-Ended Play

The culmination of the narrative is represented by multiple possible endings, and the game acknowledges the player's journey through a variety of outcomes:
	•	Ending States: Based on key decisions, which factions you supported or destroyed, your karma, and certain quest outcomes, the game can conclude in different ways. Examples of distinct ending states:
	•	Escape: The player manages to get out of the city (the original “getaway”). This could happen with different contexts – escaping alone leaving the city to its fate, escaping with a group of survivors, or escaping as part of a deal with a faction (maybe you hand control of the city to one group in exchange for your freedom).
	•	City Liberation: The player leads or significantly aids in overthrowing the oppressive powers and making the city a better place. This ending might involve establishing a new government or alliance of factions that promises hope for the average citizen.
	•	Domination: The player ends up in a position of power. For example, they become the new gang overlord or install themselves as the head of a major faction, effectively ruling the city through might or influence.
	•	Destruction/Collapse: Through action or inaction, the city falls into chaos or is destroyed. Perhaps the factions’ war goes nuclear (figuratively or literally) and the final scenes are of the city burning. The player might escape the destruction or perish with it depending on their choices.
	•	Status Quo (Bittersweet): The player fails to make large-scale change. Maybe they stop their personal nemesis or complete their personal goal, but the city remains dystopian and harsh, just with some different faces in charge. The player leaves or retires within the city, having survived but not really changed the world.
	•	Epilogue & Slides: After the final mission, the game will present an epilogue reflecting the consequences of the player’s actions. This can be done via narrated slides or in-game cutscenes. Each major faction, companion, or district might get a segment describing its fate. For example, “With the CorpSec forces defeated, the slums experienced a brief freedom, but without strong leadership, chaos soon took over until a new council of citizens was formed…” or “Having taken control of the gangs, you enforced a ruthless order in the city. Crime decreased, but only because you became the ultimate crime lord, ruling through fear.” These epilogues give closure to various plot threads and show the long-term outcome.
	•	Karma/Personality Reflections: The endings will also reflect the player’s moral standing and key choices. A high-karma player’s city liberation ending might describe how justice and compassion lead to a brighter future, while a low-karma player could liberate the city only to impose a new tyranny. If the player frequently used a particular approach (like always negotiating peace or always resorting to violence), the ending narrative might note that pattern. Essentially, the ending tries to acknowledge how you went about things, not just what you did.
	•	Multiple Endings, One Playthrough: It’s intended that a single playthrough will only show one set of ending slides (one ending scenario), so players won’t see other possibilities unless they replay. The game should make it clear through the narrative what the major branching points are, so players have hints about what could have been different. For example, an NPC might say “If someone were to unite these factions instead of pitting them against each other, maybe this city would stand a chance,” hinting at an ending path the player didn’t take.
	•	Open-Ended Play (Post-Game): We have to decide whether the player can continue playing after reaching an ending (a “free roam” mode after the final battle/decision). If the ending involves the player leaving the city or major irreversible change, continuing might not make narrative sense. One approach is to create a save point before the final sequence, so players can finish the game and then reload to do remaining side content. Another approach is if the ending was positive and the city persists, let the player wander the changed city (e.g., if they became a ruler, they can walk around and see the citizens reacting to the new order). This is something we’ll clarify in development.
	•	Replayability: The game is designed for high replay value due to the branching content. Players are encouraged to replay making different major choices: support a different faction, make opposite moral choices, play with a different character build which might open new dialogue options (like high tech vs high charisma). To facilitate this, we might allow skipping already seen dialogues or a New Game+ with some carried-over benefits (maybe retain character stats or a special item to make a second run faster). The multiple endings are a reward for replay, showing drastically different outcomes for the city.

In summary, The Getaway doesn't have one "true" ending – it has many, reflecting the complex interplay of the player's decisions throughout the game. The ending serves as the ultimate feedback on the player's impact on the world, and ideally, each ending feels like a natural result of the player's journey, providing closure (or intentional lack thereof) to the story they crafted.

Quest Variety

To keep gameplay engaging, The Getaway uses a mix of handcrafted quests and procedural (dynamically generated) tasks:
	•	Handcrafted Quests: These are carefully written and scripted missions with unique scenarios. They often have multiple stages, bespoke level design elements, and important story choices. Handcrafted quests drive the main narrative and key side stories (faction missions, companion quests, critical world events). They include detailed objectives, custom dialogue, and sometimes unique gameplay mechanics or one-off puzzles designed by the developers. For example, a handcrafted quest might involve staging an ambush on an armored convoy: it could have a setup phase (scouting and placing explosives), a combat phase, and a moral choice at the end (what to do with the survivors or the cargo).
	•	Procedural Quests: To supplement the core storyline and give the world a sense of ongoing activity, the game generates simpler quests dynamically. These quests use templates with variable parameters (location, enemy type, reward) and can occur repeatedly with variations. Examples include:
	•	Bounty Hunts: The player is tasked with hunting down a particular person or creature causing trouble. A template might be “Eliminate [Target Name], who was last seen at [Location].” The target could be a bandit leader, a rogue robot, or a mutant creature. Depending on world state, the target and location adjust (if the wasteland creatures are growing, a mutant hunt appears; if gangs are rampant, a gang boss bounty appears).
	•	Resource Runs: A faction or settlement might need supplies: “Collect X units of medicine/food/fuel and deliver them to [NPC/Location].” These encourage exploration and possibly conflict if the resources must be taken from somewhere (maybe raid a stash or trade).
	•	Rescue Missions: A random NPC (or minor character related to an area) gets in trouble: “So-and-so was kidnapped by raiders and is being held at [Location]” or “A lost child wandered into the sewer system.” The game can generate a suitable location and enemies for the hostage scenario.
	•	Escort/Delivery: “Escort this caravan/trader to another district” or “Carry this important item to an NPC in a different zone.” Along the way, there may be ambushes or obstacles.
	•	Territory Defense or Invasion: If the simulation detects one faction attacking another, it can create a quest for the player: “Help defend [Location] from an attack by [Faction]” or vice versa “Join [Faction] in an attack on [Location].” These are more dynamic since they depend on the current faction relations.
	•	Procedural quests are delivered through in-world means to maintain immersion. You might find a “Wanted” poster, get a radio call or distress signal, or an NPC runner might approach you with a request. They are often optional and can be ignored or picked up at leisure, but they provide opportunities to earn extra rewards, gain reputation, and encounter combat scenarios outside the main storyline.
	•	Quality and Limitations: We will ensure procedural quests remain simple enough that their generated nature isn’t immersion-breaking. They won’t have complex dialogue trees or huge plot twists; they are straightforward tasks. However, we will write enough flavor variations so they don’t all feel identical. For instance, even if “bounty hunt” repeats, the targets will have different little backstories or reasons (given in a mission briefing or by examining a crime scene).
	•	Balancing with Story: Handcrafted quests will generally yield bigger story developments and significant rewards (rare items, big rep changes). Procedural quests give modest rewards and help with grinding or world immersion. Players who just follow the main quests will get a complete story, but those who engage with procedural quests will find the world feels more alive and will be better prepared (via extra XP and gear) for tough challenges. The game design will avoid requiring grinding procedural quests; they are there for fun and depth, not as filler that must be done.

By combining handcrafted and procedural content, The Getaway provides both a curated narrative experience and an endless stream of small-scale activities. This keeps the game world feeling busy and gives players flexibility to pursue their own priorities (be it story, character improvement, or just exploration for its own sake).

Faction-Based Quests & World Impact

Faction quests are a major component of the game and directly influence the balance of power in the world:
	•	Dedicated Quest Lines: Each major faction has its own quest line that advances their agenda. For example, a faction quest line for the Resistance might include missions to: infiltrate a communications tower to broadcast a message, protect a gathering of sympathizers, assassinate a key official, and finally lead an assault on the government headquarters. These quests are interwoven with narrative scenes that develop faction characters and ethos (you learn why they fight and what they’ll do if they win).
	•	Shifting Power Dynamics: Completing faction quests will usually strengthen that faction and weaken their enemies. The game keeps track of territory control and influence. If you do a series of quests for the Warlords gang to eliminate a rival gang and intimidate the populace, you’ll see the Warlords’ graffiti and patrols extend into new areas, and the rival gang’s presence will diminish or vanish. NPCs in those areas will comment on the change (e.g., “Ever since the Black Snakes were wiped out, the Warlords run these streets. It’s a bit safer for us civilians now, if you don’t cross them.”).
	•	Exclusive Alignments: Often, progressing to the later stages of a faction’s quest line will lock you out of others. If you become the champion of Faction A and help them conquer significant objectives, Faction B (their main competitor) will likely turn hostile or at least refuse to give you quests. This is communicated through the storyline – perhaps Faction B labels you a traitor or your actions directly pit you against them in battle. The game might allow some degree of playing both sides early on, but eventually, you’ll face a choice whom to side with in a critical conflict.
	•	Multiple Approaches: Some faction quests may offer branching within themselves. For instance, a faction leader might give you a goal but you can choose how to achieve it: bribe an enemy official versus publicly expose them. Your method could tilt that faction’s approach later (a violent solution vs a diplomatic one). In some cases, the player might even get the chance to influence leadership – for example, supporting a more moderate member of the faction to take over instead of the current radical leader, thereby changing the faction’s character (this could occur if the faction leader’s trust in you is high and you complete a special quest to sway their council).
	•	World Reactions: The rest of the world doesn’t sit idle while one faction rises. Other factions will react. If you help the cult-like faction gain power, the staunch realists or secular groups might start opposing you or prepare counter-moves (which could become quests on their side if you defect or if you later change course). The news (if there’s radio or rumor system) will spread word of faction victories or defeats. Neutral NPCs might change their behavior (merchants might raise prices if the faction controlling their area is unfriendly to you now, or vice versa).
	•	Faction Quest Rewards: Aside from story outcomes, completing faction quests yields tangible rewards. This could be unique equipment (a special weapon or armor emblazoned with the faction’s insignia), access to services (like being able to call for backup from that faction in combat, or use their safehouses), and of course, high reputation with that faction. Eventually, if you go deep enough, the faction might essentially treat you as one of their own or even offer you leadership. In some endings, the player can effectively lead a faction to rule the city, which is an ultimate “reward” in narrative terms.

Faction quests ensure that the game's political landscape is an integral part of the gameplay. By choosing which faction quests to pursue, the player is actively choosing winners and losers in the city, and they get to see the results of those choices play out in real time. This gives a strategic layer to questing: it's not just about experience points, but about sculpting the world's power structure.
